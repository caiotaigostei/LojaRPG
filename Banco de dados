CREATE DATABASE Loja_RPG;
USE Loja_RPG;

CREATE TABLE Cliente (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nome VARCHAR(100) NOT NULL,
  idade SMALLINT UNSIGNED,
  sexo ENUM('M','F','O'),
  data_nascimento DATE
  CONSTRAINT unq_nome_data UNIQUE (nome, data_nascimento)
);

CREATE TABLE clientes_especiais (
  cliente_id INT PRIMARY KEY,
  cashback DECIMAL(10,2) DEFAULT 0.00,
  FOREIGN KEY (cliente_id) REFERENCES Cliente(id)
);

CREATE TABLE Vendedor (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nome VARCHAR(100) NOT NULL,
  causa_social VARCHAR(100) NOT NULL,
  nota_media DECIMAL(3,1) DEFAULT 0.00
);

CREATE TABLE Produtos (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nome VARCHAR(100) NOT NULL,
  descricao TEXT,
  quantidade_em_estoque INT UNSIGNED DEFAULT 0 CHECK(quantidade_em_estoque >= 0),
  valor DECIMAL(10,2) CHECK(valor >= 0),
  observacoes TEXT,
  vendedor_id INT,
  FOREIGN KEY (vendedor_id) REFERENCES Vendedor(id)
);

CREATE TABLE transportadoras (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nome VARCHAR(100) NOT NULL,
  cidade VARCHAR(100)
);

CREATE TABLE Venda (
  id INT AUTO_INCREMENT PRIMARY KEY,
  cliente_id INT,
  transportadora_id INT,
  data_hora DATETIME DEFAULT NOW(),
  endereco_des VARCHAR(100),
  valor_transp DECIMAL(10,2) DEFAULT 0.00 CHECK(valor_transp >= 0),
  FOREIGN KEY (cliente_id) REFERENCES Cliente(id),
  FOREIGN KEY (transportadora_id) REFERENCES transportadoras(id)
);

CREATE TABLE venda_produtos (
  venda_id INT,
  produto_id INT,
  quantidade INT UNSIGNED default 1 CHECK(quantidade > 0),
  primary key(venda_id,produto_id),
  FOREIGN KEY(venda_id) REFERENCES Venda(id),
  FOREIGN KEY(produto_id) REFERENCES Produtos(id)
);
